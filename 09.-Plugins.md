# ðŸ”Œ Plugin System

PHPico includes a clean and lightweight plugin system that allows you to extend the framework with zero configuration.

Plugins can provide additional configuration, templates (views), and custom logic via a `bootstrap.php` file. Once a plugin is installed via Composer, it is automatically detected and integrated.

---

## Plugin Structure

A PHPico plugin mimics the structure of a full app:

```
your-plugin/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ config.php         // Plugin-specific configuration
â”‚   â””â”€â”€ views/             // Plugin-specific templates
â”‚       â””â”€â”€ example.phtml
â”œâ”€â”€ bootstrap.php          // Bootstrap logic (routes, events, services, etc.)
â””â”€â”€ composer.json
```

- `app/config.php` is merged into the global config.
- `app/views/` is added to the view resolver.
- `bootstrap.php` is automatically executed when the plugin is discovered.

---

## Automatic Discovery

Plugins are discovered via Composer using the package `"type": "phpico-plugin"`:

```json
{
  "name": "vendor/my-plugin",
  "type": "phpico-plugin"
}
```

Once installed, PHPico will:

- Load `bootstrap.php`
- Merge `app/config.php`
- Register all `app/views/` templates

No manual registration is needed.

---

## Accessing Plugin Metadata

For advanced use cases, you can inspect registered plugin data:

```php
plugin()->getMeta('viewPaths');
plugin()->getMeta('configPaths');
plugin()->getMeta('bootstraps');
```

Typically, this is handled automatically and doesn't require manual access.

---

## Example Plugin: Error Views

This plugin provides custom 404 and 500 error pages:

```
my-error-plugin/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ views/
â”‚       â””â”€â”€ errors/
â”‚           â”œâ”€â”€ 404.phtml
â”‚           â””â”€â”€ 500.phtml
â””â”€â”€ bootstrap.php
```

Once installed, the plugin's templates are available for use in:

```php
render('errors.404');
```

They can be overridden by placing the same file in your appâ€™s `app/views/errors/` folder.

---

## ðŸ§­ Example Plugin: Routing to a Controller

Plugins can register their own routes that point to controller logic inside the plugin.

### Plugin structure:

```
my-hello-plugin/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ Controllers/
â”‚       â””â”€â”€ HelloController.php
â”œâ”€â”€ bootstrap.php
â””â”€â”€ composer.json
```

### `HelloController.php`

```php
namespace MyHelloPlugin\Controllers;

use Psr\Http\Message\ResponseInterface;
use function PHPico\response;

class HelloController
{
    public function index(): ResponseInterface
    {
        return response('Hello from the plugin controller!');
    }
}
```

### `bootstrap.php`

Register the route:

```php
use MyHelloPlugin\Controllers\HelloController;
use function PHPico\router;

router()->add('GET', '/plugin-hello', [HelloController::class, 'index']);
```

### `composer.json` (autoload setup)

```json
{
  "name": "vendor/my-hello-plugin",
  "type": "phpico-plugin",
  "autoload": {
    "psr-4": {
      "MyHelloPlugin\\": "app/Controllers/"
    }
  }
}
```

Run:

```bash
composer dump-autoload
```

Then visit:

```
http://yourapp.local/plugin-hello
```

Youâ€™ll see:

```
Hello from the plugin controller!
```

---

## View Resolution Order

Templates are resolved in this order:

1. `app/views/` (main app)
2. All `plugin/app/views/`
3. `core/Resources/views/` (framework fallback)

This means plugins can provide templates that the app can override if needed.

---

## Config Merge Order

Configuration arrays are merged recursively in this order:

1. `core/config.php`
2. All plugin `app/config.php`
3. `app/config.php` (main app)

This ensures that plugin values can be overridden cleanly.

---

## Summary

- Plugins follow the same `app/` structure as the main application.
- They are auto-discovered and auto-loaded via Composer (`type: phpico-plugin`).
- You can register routes, provide controllers, configuration and templates.
- No manual registration or boot logic needed in the app.
- Override behavior is consistent and predictable.